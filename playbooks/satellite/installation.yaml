---
- hosts: satellite6
  remote_user: root
  ###gather_facts: no
  vars_files:
    - ../../conf/satperf.yaml
    - ../../conf/satperf.local.yaml
  roles:
    - role: ../common/roles/epel-not-present
    - role: rhsm_helper
      vars:
        registration_options: "{{ satellite_registration_options }}"
    - role: repo_setup
      vars:
        additional_repos: "{{ satellite_additional_repos }}"
    - role: ../common/roles/plain-network
    - role: ../common/roles/common
    - role: linux-system-roles.timesync
    ###- role: upgrade-restart
    ###- role: satellite-ec2-partitioning
    - role: ../common/roles/remove-home-extend-root
    - role: linux-system-roles.firewall
      vars:
        firewall:
          - service: "RH-Satellite-6"
            state: enabled
    - role: ../common/roles/partition-new-storage
      vars:
        storage_pools:
         - name: satellite_data
           disks:
             - "{{ storage_pools_disk }}"
           volumes:
             - name: mongodb
               size: 50G
               fs_type: xfs
               mount_point: /var/lib/mongodb
             - name: opt
               size: 3G
               fs_type: xfs
               mount_point: /opt
             - name: postgresql
               size: 10G
               fs_type: xfs
               mount_point: /var/opt/rh/rh-postgresql12
             - name: pulp
               size: 300G
               fs_type: xfs
               mount_point: /var/lib/pulp
             - name: pulp_cache
               size: 50G
               fs_type: xfs
               mount_point: /var/cache/pulp
             - name: puppetlabs
               size: 500M
               fs_type: xfs
               mount_point: /opt/puppetlabs
             - name: squid
               size: 10G
               fs_type: xfs
               mount_point: /var/spool/squid
      when:
        - partition_new_storage is defined and partition_new_storage == True
        - sat_version is version('6.9', '<=')
    - role: ../common/roles/partition-new-storage
      vars:
        storage_pools:
         - name: satellite_data
           disks:
             - "{{ storage_pools_disk }}"
           volumes:
             - name: opt
               size: 3G
               fs_type: xfs
               mount_point: /opt
             - name: postgresql
               size: 20G
               fs_type: xfs
               mount_point: /var/opt/rh/rh-postgresql12/lib/pgsql
             - name: pulp
               size: 300G
               fs_type: xfs
               mount_point: /var/lib/pulp
             - name: puppetlabs
               size: 500M
               fs_type: xfs
               mount_point: /opt/puppetlabs
             - name: qpidd
               size: 1G
               fs_type: xfs
               mount_point: /var/lib/qpidd
      when:
        - partition_new_storage is defined and partition_new_storage == True
        - sat_version is version('6.10', '>=')
    - role: setup
    - role: enable-remote-exec-by-ip
    - role: ../common/roles/enlarge-arp-table
    - role: puppet-autosign
...
