---
- name: Check that provided path is a real file
  ansible.builtin.stat:
    path: "{{ content_file }}"
  delegate_to: localhost
  register: st

- when:
    - st.stat.exists
  block:
    - name: Copy content over to /etc/foreman-installer/custom-hiera.yaml
      ansible.builtin.blockinfile:
        block: "{{ lookup('ansible.builtin.file', '{{ content_file }}') }}"
        path: /etc/foreman-installer/custom-hiera.yaml
        prepend_newline: true
        append_newline: true
        backup: true
      when:
        - marker_postfix is not defined or marker_postfix | length == 0

    - name: Copy content over to /etc/foreman-installer/custom-hiera.yaml
      ansible.builtin.blockinfile:
        block: "{{ lookup('ansible.builtin.file', '{{ content_file }}') }}"
        path: /etc/foreman-installer/custom-hiera.yaml
        marker: "# {mark} ANSIBLE MANAGED BLOCK - {{ marker_postfix }}"
        prepend_newline: true
        append_newline: true
        backup: true
      when:
        - marker_postfix is defined and marker_postfix | length > 0

    - name: Remove file now that its content have been copied
      ansible.builtin.file:
        path: "{{ content_file }}"
        state: absent
      delegate_to: localhost
...
